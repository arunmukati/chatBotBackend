// const { mongooseDb } = require('../db/db');
const mongoose = require('mongoose');
const { userModel } = require('.');

// var jwt = require('jsonwebtoken');

class UserModel  {
   
    static get tableName() {
        return 'users';
    }
    static get schema(){
      return  new mongoose.Schema({
            firstname:  String,
            lastname: String,
            mobile:  Number,
            email:  String,
            dob:  String,
            gender:  String,
            address: String
        });
    }
   

    // static get relationMappings() {
    //     return {
    //         class: {
    //             relation: Model.HasOneRelation,
    //             modelClass: ClassroomModel,
    //             join: {
    //                 from: 'teacher.classroom_id',
    //                 to: 'classroom.id'
    //             }
    //         },
    //         schools: {
    //             relation: Model.ManyToManyRelation,
    //             modelClass: School,
    //             join: {
    //                 from: 'teacher.id',
    //                 through: {
    //                     from: 'teacher_school.teacher_id',
    //                     to: 'teacher_school.school_id'
    //                 },
    //                 to: 'school.id'
    //             }
    //         },
    //         teacherClasses: {
    //             relation: Model.ManyToManyRelation,
    //             modelClass: ClassroomModel,
    //             join: {
    //                 from: 'teacher.id',
    //                 through: {
    //                     from: 'teacher_class.teacher_id',
    //                     to: 'teacher_class.classroom_id'
    //                 },
    //                 to: 'classroom.id'
    //             }
    //         }
    //     }
    // }

}

UserModel.checkIsUniqueMobile = function (mobile, exceptPrimaryId) {
    // let q = this.find
    let query = this.query()
        .where('mobile', mobile);
    if (exceptPrimaryId) {
        query.whereNot('id', exceptPrimaryId);
    }
    return query
        .first()
        .then((response) => {
            if (!response) return Promise.resolve(true);
            return Promise.resolve(false);
        });
}
UserModel.checkIsUniqueEmail = function (email, exceptPrimaryId) {
    let query = this.query()
        .where('email', email);
    if (exceptPrimaryId) {
        query.whereNot('id', exceptPrimaryId);
    }
    return query
        .first()
        .then((response) => {
            if (!response) return Promise.resolve(true);
            return Promise.resolve(false);
        });
}

// Teacher.generateUniqueApikey = function () {
//     let apikey = jwt.sign({
//         time: Date.now()
//     }, 'teacher');

//     return this.query()
//         .where('apikey', apikey)
//         .then(async (res) => {
//             if (!res.length) return Promise.resolve(apikey);
//             return await Teacher.generateUniqueApikey();
//         });
// }

UserModel.mongooseModel=()=>{ 
    const schema = new mongoose.Schema({
    firstname:  String,
    lastname: String,
    mobile:  Number,
    email:  String,
    dob:  String,
    gender:  String,
    address: String
});
return mongoose.model(this.tableName, schema);

}
module.exports = UserModel;